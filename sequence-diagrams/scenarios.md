# 유즈케이스 시나리오

이 문서는 각 유즈케이스에 대한 상세 시나리오를 설명합니다.

---

## UC1: 주문 하기

**액터**: 고객 (Customer)

**전제 조건**:
- 고객이 로그인되어 있음
- 고객의 카드 정보가 등록되어 있음

**시나리오**:

### 1. 정상 흐름 (Main Flow)

1. 고객이 주문 페이지에서 저녁 식사 타입, 제공 방식, 배송 시간, 배송 주소, 추가 메뉴 항목을 선택
2. 시스템이 주문 정보를 검증 (주소, 시간, 메뉴 등)
3. 시스템이 재고를 확인하고 예약
4. 시스템이 가격을 계산 (기본 제공 항목 + 추가 항목)
5. 시스템이 로열티 할인 적용 여부 확인 (배달 완료 4회 이상)
6. 시스템이 주문을 생성하고 "pending" 상태로 저장
7. 시스템이 재고 예약을 생성
8. 시스템이 주문 정보를 고객에게 반환
9. 고객이 결제 정보를 확인하고 결제 진행
10. 시스템이 결제 상태를 "paid"로 업데이트
11. 주문 생성 완료

### 2. 대안 흐름 (Alternative Flows)

**2a. 재고 부족**
- 3단계에서 재고가 부족한 경우
- 시스템이 에러 메시지를 반환
- 유즈케이스 종료

**2b. 카드 정보 없음**
- 전제 조건에서 카드 정보가 없는 경우
- 시스템이 "카드 정보 등록 필요" 메시지를 반환
- 유즈케이스 종료

**2c. 배달 시간 검증 실패**
- 2단계에서 배달 시간이 유효하지 않은 경우
- 시스템이 에러 메시지를 반환
- 유즈케이스 종료

**2d. 중복 주문 방지**
- 동일한 요청이 50초 이내에 재전송되는 경우
- 시스템이 중복 주문을 차단
- 유즈케이스 종료

### 3. 포함된 유즈케이스

- **Payment (결제)**: 주문 생성 후 결제 프로세스 진행

---

## UC2: 주문 내역 조회

**액터**: 고객 (Customer)

**전제 조건**:
- 고객이 로그인되어 있음

**시나리오**:

### 1. 정상 흐름 (Main Flow)

1. 고객이 주문 내역 페이지 접근
2. 시스템이 사용자 ID를 인증 정보에서 추출
3. 시스템이 해당 사용자의 모든 주문을 조회
4. 시스템이 각 주문의 상세 정보(주문 항목, 메뉴 정보 등)를 조회
5. 시스템이 주문 목록을 고객에게 반환
6. 고객이 주문 내역을 확인

### 2. 대안 흐름 (Alternative Flows)

**2a. 인증 실패**
- 2단계에서 인증 정보가 없는 경우
- 시스템이 401 에러를 반환
- 유즈케이스 종료

**2b. 주문 없음**
- 3단계에서 주문이 없는 경우
- 시스템이 빈 목록을 반환
- 정상 흐름 계속

### 3. 확장 유즈케이스

- **UC6 (예약 변경 요청 관리)**: 주문 내역에서 예약 변경 요청 가능

---

## UC5: 주문 관리

**액터**: 직원 (Employee), 관리자 (Admin)

**전제 조건**:
- 직원/관리자가 로그인되어 있음
- 해당 권한이 있음

**시나리오**:

### 1. 정상 흐름 (Main Flow)

1. 직원/관리자가 주문 관리 페이지 접근
2. 시스템이 주문 목록을 조회 (필터: 상태, 날짜 등)
3. 시스템이 주문 상세 정보를 조회
4. 직원/관리자가 주문 상태를 변경 (승인, 조리 시작, 배송 시작, 배송 완료 등)
5. 시스템이 주문 상태를 업데이트
6. 시스템이 변경 사항을 저장
7. 주문 관리 완료

### 2. 대안 흐름 (Alternative Flows)

**2a. 권한 없음**
- 1단계에서 권한이 없는 경우
- 시스템이 403 에러를 반환
- 유즈케이스 종료

**2b. 주문 없음**
- 2단계에서 조회된 주문이 없는 경우
- 시스템이 빈 목록을 반환
- 정상 흐름 계속

---

## UC6: 예약 변경 요청 관리

**액터**: 고객 (Customer), 관리자 (Admin)

**전제 조건**:
- 고객: 로그인되어 있고, 변경 가능한 주문이 있음
- 관리자: 로그인되어 있고, 승인 권한이 있음

**시나리오**:

### 고객 측: 변경 요청 생성

1. 고객이 주문 내역에서 변경 요청 버튼 클릭
2. 시스템이 주문의 변경 가능 여부 확인 (배달 3일 전까지)
3. 고객이 변경 사항 입력 (새로운 디너 타입, 배송 시간, 배송 주소 등)
4. 시스템이 변경 요청 금액 계산 (차액 + 변경 수수료)
5. 시스템이 변경 요청을 "REQUESTED" 상태로 생성
6. 시스템이 변경 요청 정보를 고객에게 반환

### 관리자 측: 변경 요청 승인/거부

1. 관리자가 예약 변경 요청 목록 조회
2. 시스템이 변경 요청 목록 반환
3. 관리자가 변경 요청 상세 정보 확인
4. 관리자가 승인 또는 거부 결정
5. 승인 시:
   - 시스템이 추가 결제/환불 금액 계산
   - 시스템이 결제/환불 처리
   - 시스템이 주문 정보 업데이트
   - 시스템이 재고 조정
6. 거부 시:
   - 시스템이 거부 사유 입력
   - 시스템이 변경 요청 상태를 "REJECTED"로 변경
7. 변경 요청 처리 완료

### 대안 흐름

**변경 가능 기한 지남**
- 2단계에서 변경 가능 기한이 지난 경우
- 시스템이 "변경 가능 기한이 지났습니다" 메시지 반환
- 유즈케이스 종료

**이미 처리 중인 변경 요청 존재**
- 5단계에서 이미 처리 중인 변경 요청이 있는 경우
- 시스템이 에러 메시지 반환
- 유즈케이스 종료

---

## UC3: 재고 확인

**액터**: 직원 (Employee), 관리자 (Admin)

**전제 조건**:
- 직원/관리자가 로그인되어 있음
- 해당 권한이 있음

**시나리오**:

### 1. 정상 흐름 (Main Flow)

1. 직원/관리자가 재고 관리 페이지 접근
2. 시스템이 주 단위 재고 스냅샷 조회
3. 시스템이 각 메뉴 아이템의 재고 정보 계산:
   - 윈도우당 최대 수용량
   - 예약된 수량
   - 남은 수량
   - 주문된 수량
4. 시스템이 재고 목록을 직원/관리자에게 반환
5. 직원/관리자가 재고 상태 확인

### 2. 확장 유즈케이스

- **재고 보충 요청 (Replenish)**: 재고 확인 중 재고가 부족한 경우 보충 요청 가능

---

## UC3 확장: 재고 보충 요청

**액터**: 직원 (Employee), 관리자 (Admin)

**전제 조건**:
- 재고 확인 유즈케이스가 실행 중임
- 재고가 부족한 메뉴 아이템이 있음

**시나리오**:

### 1. 정상 흐름 (Main Flow)

1. 직원/관리자가 재고가 부족한 메뉴 아이템 선택
2. 시스템이 보충 수량 입력 폼 표시
3. 직원/관리자가 보충 수량 입력
4. 시스템이 재고 보충 요청 생성
5. 시스템이 재고 정보 업데이트
6. 재고 보충 요청 완료

---

## UC4: 스케줄 조회

**액터**: 직원 (Employee), 관리자 (Admin)

**전제 조건**:
- 직원/관리자가 로그인되어 있음
- 해당 권한이 있음

**시나리오**:

### 1. 정상 흐름 (Main Flow)

1. 직원/관리자가 스케줄 관리 페이지 접근
2. 시스템이 배송 스케줄 목록 조회 (필터: 날짜, 직원 등)
3. 시스템이 각 스케줄의 상세 정보 조회:
   - 배송 주소
   - 출발 시간
   - 도착 시간
   - 복귀 시간
   - 담당 직원
4. 시스템이 스케줄 목록을 직원/관리자에게 반환
5. 직원/관리자가 스케줄 확인

---

## UC7: 계정 관리

**액터**: 관리자 (Admin)

**전제 조건**:
- 관리자가 로그인되어 있음
- 관리자 권한이 있음

**시나리오**:

### 1. 정상 흐름 (Main Flow)

1. 관리자가 계정 관리 페이지 접근
2. 시스템이 사용자 목록 조회
3. 시스템이 각 사용자의 상세 정보 조회:
   - 이메일, 이름, 주소
   - 역할 (고객, 직원, 관리자)
   - 승인 상태
   - 직원 타입 (직원인 경우)
4. 관리자가 사용자 생성/수정/삭제 또는 승인 상태 변경
5. 시스템이 사용자 정보 업데이트
6. 계정 관리 완료

### 2. 대안 흐름

**직원 계정 생성**
- 4단계에서 직원 계정을 생성하는 경우
- 시스템이 직원 타입(요리사/배송원)을 요청
- 시스템이 승인 상태를 "pending"으로 설정
- 관리자가 나중에 승인

---

## 공통 시나리오 요소

### 인증 및 권한

모든 유즈케이스는 다음 인증 단계를 포함합니다:

1. 클라이언트가 JWT 토큰을 요청 헤더에 포함
2. JwtAuthenticationFilter가 토큰 검증
3. SecurityContext에 사용자 정보 설정
4. 컨트롤러에서 인증 정보 추출
5. 권한 확인 (필요한 경우)

### 오류 처리

모든 유즈케이스는 다음 오류 상황을 처리합니다:

- 인증 실패 (401)
- 권한 없음 (403)
- 잘못된 요청 (400)
- 서버 오류 (500)

---

